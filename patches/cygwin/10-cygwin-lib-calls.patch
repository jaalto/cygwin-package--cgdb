From: Jari Aalto <jari.aalto@cante.net>
Subject: Update function calls that working with Cygwin 1.7 but no longer.
  The fix is for packge version 0.6.7
  See https://cygwin.com/cygwin-api/cygwin-functions.html#func-cygwin-conv-path
---
 lib/util/fs_util.c |   17 ++++++++++++++---
 1 file changed, 14 insertions(+), 3 deletions(-)

--- a/lib/util/fs_util.c
+++ b/lib/util/fs_util.c
@@ -39,6 +39,17 @@
 
 #define MAXLINE 4096
 
+#if defined(__CYGWIN__)
+#include <sys/cygwin.h> // for cygwin_conv_path()
+/* https://cygwin.com/ml/gdb-patches/2010-02/msg00677.html
+   The maximum path length in Cygwin is no longer MAX_PATH.  Rather it
+   is PATH_MAX, which is now 4096.  Actually, even paths up to 32K are
+   supported, which is the maximum path length of the underlying Windows,
+   but usually 4K is more than enough.
+ */
+#define MAX_PATH PATH_MAX
+#endif
+
 /* TODO: The cgywin_conv functions used here are deprecated. */
 
 int fs_util_is_valid(const char *dir)
@@ -56,7 +67,7 @@ int fs_util_is_valid(const char *dir)
 
     /* Get the directory to check */
 #ifdef HAVE_CYGWIN
-    cygwin_conv_to_full_win32_path(dir, cygwin_actual_dir);
+    cygwin_conv_path(CCP_POSIX_TO_WIN_W, dir, cygwin_actual_dir, MAX_PATH);
     strncpy(actual_dir, cygwin_actual_dir, strlen(cygwin_actual_dir) + 1);
 #else
     strncpy(actual_dir, dir, strlen(dir) + 1);
@@ -94,7 +105,7 @@ int fs_util_create_dir(const char *dir)
 
     /* Get the directory to check */
 #ifdef HAVE_CYGWIN
-    cygwin_conv_to_full_win32_path(dir, cygwin_actual_dir);
+    cygwin_conv_path(CCP_POSIX_TO_WIN_W, dir, cygwin_actual_dir, MAX_PATH);
     strncpy(actual_dir, cygwin_actual_dir, strlen(cygwin_actual_dir) + 1);
 #else
     strncpy(actual_dir, dir, strlen(dir) + 1);
@@ -149,7 +160,7 @@ void fs_util_get_path(const char *base,
     sprintf(dir, "%s/%s", base, name);
 
 #ifdef HAVE_CYGWIN
-    cygwin_conv_to_full_win32_path(dir, path);
+    cygwin_conv_path(CCP_POSIX_TO_WIN_W, dir, path, MAX_PATH);
 #else
     strncpy(path, dir, strlen(dir) + 1);
 #endif
